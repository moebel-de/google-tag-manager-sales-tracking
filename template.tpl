___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "moebel.de Salestracking",
  "categories": ["CONVERSIONS", "ADVERTISING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2NzA1ODg5OC1mY2I1LWNiNDQtOTkxNy03ZmNlYWRmZjI1Y2QiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjRBMzAxODM5MDE0MTFFOEE1MzZEODZDNTQ3OEEwRjQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjRBMzAxODI5MDE0MTFFOEE1MzZEODZDNTQ3OEEwRjQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6YjI2YjkxYmYtODU5Yy0yNjQ1LThiMTEtZjVjN2ZkOTI4MjQ0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjY3MDU4ODk4LWZjYjUtY2I0NC05OTE3LTdmY2VhZGZmMjVjZCIv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"
  },
  "description": "The moebel.de Salestracking template helps you to send purchase data to moebel.de.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "eventType",
    "displayName": "Event Type",
    "radioItems": [
      {
        "value": "base_code",
        "displayValue": "Base Code"
      },
      {
        "value": "conversion",
        "displayValue": "Conversion"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "base_code",
    "help": "\u003cb\u003eBase Code\u003c/b\u003e: stores the clickID inside a cookie called moeclid \u003cbr\u003e\u003cbr\u003e \u003cb\u003eConversion\u003c/b\u003e: sends a sale request"
  },
  {
    "type": "SELECT",
    "name": "urlSource",
    "displayName": "URL Source",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "page_location_default",
        "displayValue": "page_location"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "base_code",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "defaultValue": "page_location_default",
    "help": "Select \u003cb\u003epage_location\u003c/b\u003e to use URL from \u003ca href\u003d\"https://developers.google.com/tag-manager/serverside/common-event-data\" target\u003d\"_blank\"\u003eCommon Event Data\u003c/a\u003e or provide a variable with a valid URL string."
  },
  {
    "type": "SELECT",
    "name": "portal",
    "displayName": "Portal",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "https://redirect.moebel.de/api/1.0/moebel/de/sales",
        "displayValue": "moebel.de"
      },
      {
        "value": "https://redirect.meubles.fr/api/1.0/moebel/fr/sales",
        "displayValue": "meubles.fr"
      },
      {
        "value": "https://redirect.meubelo.nl/api/1.0/moebel/nl/sales",
        "displayValue": "meubelo.nl"
      },
      {
        "value": "https://redirect.moebel24.at/api/1.0/moebel/at/sales",
        "displayValue": "moebel24.at"
      },
      {
        "value": "https://redirect.moebel24.ch/api/1.0/moebel/ch/sales",
        "displayValue": "moebel24.ch"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Choose the portal, you want to send the sale request to."
  },
  {
    "type": "TEXT",
    "name": "partnerKey",
    "displayName": "Partner Key",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Enter the key provided by your account manager."
  },
  {
    "type": "GROUP",
    "name": "bodyDataGroup",
    "displayName": "JSON Request Body",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "bodyData",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property",
            "name": "key",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "moeclid",
                "displayValue": "moeclid"
              },
              {
                "value": "value",
                "displayValue": "value"
              },
              {
                "value": "shipping",
                "displayValue": "shipping"
              },
              {
                "value": "items",
                "displayValue": "items"
              },
              {
                "value": "currency",
                "displayValue": "currency"
              },
              {
                "value": "order_id",
                "displayValue": "order_id"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "notSetText": "",
        "newRowButtonText": "Add property",
        "enablingConditions": [
          {
            "paramName": "eventType",
            "paramValue": "conversion",
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require("sendHttpRequest");
const getEventData = require("getEventData");
const JSON = require("JSON");
const setCookie = require("setCookie");
const parseUrl = require("parseUrl");
const encodeUriComponent = require("encodeUriComponent");
const getRequestHeader = require("getRequestHeader");
const traceId = getRequestHeader("trace-id");
const makeTableMap = require("makeTableMap");
const logToConsole = require("logToConsole");
const getContainerVersion = require("getContainerVersion");

const COOKIE_OPTIONS = {
  domain: "auto",
  path: "/",
  secure: true,
  "max-age": 7776000,
  httpOnly: false,
};

function determinateIsLoggingEnabled( data ) {
  const logType = data.logType;
  if (!logType || logType === "debug") {
    return getContainerVersion().debugMode;
  }
  return logType === "always";
}


function processBaseCode(dataToProcess) {
  const urlSource = dataToProcess.urlSource;
  const parsedUrl = parseUrl(
    urlSource === "page_location_default" ? getEventData("page_location") : urlSource
  );


  const name = "moeclid";
  const value =
    parsedUrl && parsedUrl.searchParams ? parsedUrl.searchParams[name] : "";


  if (value) {
    setCookie(name, value, COOKIE_OPTIONS, false);
  }

  dataToProcess.gtmOnSuccess();
}

function handleResponseFactory(dataToProcess, isLoggingEnabled) {
  return (statusCode, responseHeaders, responseBody) => {
    if (isLoggingEnabled) {
      logToConsole(
        JSON.stringify({
          Name: "moebel.de",
          TraceId: traceId,
          EventName: "Sale",
          Type: "Response",
          ResponseStatusCode: statusCode,
          ResponseHeaders: responseHeaders,
          ResponseBody: responseBody,
        })
      );
    }

    return statusCode >= 200 && statusCode < 300 ? dataToProcess.gtmOnSuccess() : dataToProcess.gtmOnFailure();
  };
} 

function processData(dataToProcess) {
  const eventType  = dataToProcess.eventType;
  const portal  = dataToProcess.portal;
  const partnerKey = dataToProcess.partnerKey;
  const bodyData = dataToProcess.bodyData;
  const isLoggingEnabled = determinateIsLoggingEnabled(dataToProcess);

  if (eventType === "base_code") {
    return processBaseCode(dataToProcess);
  }

  const postUrl = portal+"?key="+encodeUriComponent(
    partnerKey || ""
  );
  const postBodyData = bodyData ? makeTableMap(bodyData, "key", "value") : {};

  postBodyData.type = "s2s";

  if (isLoggingEnabled) {
    logToConsole(
      JSON.stringify({
        Name: "moebel.de",
        TraceId: traceId,
        EventName: "Sale",
        Type: "Request",
        RequestMethod: "POST",
        RequestUrl: postUrl,
        RequestBody: postBodyData,
      })
    );
  }

  sendHttpRequest(
    postUrl,
    handleResponseFactory(dataToProcess, isLoggingEnabled),
    {
      headers: { "Content-Type": "application/json" },
      method: "POST",
    },
    JSON.stringify(postBodyData)
  );
}

processData(data);


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "moeclid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 24.4.2023, 14:16:40


